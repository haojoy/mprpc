## 单机服务器

假设拥有一个单机的聊天服务器，它的缺点是什么？

1. 受限于硬件资源，聊天服务器所承受的用户的并发量不大
2. 这里面的模块很多，有很多的函数方法。放到一个单机服务器里面编译部署涉及到了所有的模块，这效率十分低。比如某个模块需要修改，但是需要让整个项目重新编译部署，这就是单机服务器的缺陷。
3. 系统中，有些模块是CPU密集型的（对CPU需求更大，比如一些图像计算，全是CPU在跑），有的模块是IO密集型的（读写磁盘操作很多，webServer就是，耗时都在等待信息到来）。因此各个模块对于硬件的资源需求不一样。但是我们并没有根据需求提供不同的机器配置，我们只要一个单机服务器。

**如何判断进程是IO密集还是CPU密集**	

看进程是否频繁读写磁盘，比如在Linux上，一切皆文件，web应用就需要频繁read和write消息，这些都是建立在磁盘上的，这种就是IO密集型，比如上面举的例子，计算圆周率，不需要与磁盘发生太多关系，只让CPU疯狂计算，这就是CPU密集型了。

## 集群服务器

那好，我们引入多台服务器，比如现在把单机聊天服务器变成了集群聊天服务器。每个服务器独立运行一个聊天系统。那么它是否解决了上述的问题呢？

1. 并发量上升了，因为现在的服务器数量多了。
2. 编译部署并未提升，因为所有模块还是运行在一个服务器里。我们需要编译所有模块，而且部署需要部署在更多的机器上。
3. 并没有根据CPU密集型而IO密集型，没有按照各模块对硬件的需求配置到不同机器上。

![img](https://cdn.nlark.com/yuque/0/2022/png/26752078/1659511803168-0034553a-3955-4752-b9b5-99574577bd8d.png)后台管理的模块根本不需要高并发，所以不需要把他部署到三台机器上面。放到单独的一个机器上就行了，但是集群服务器只能这样。

## 分布式系统

模块拆分，单独部署到不同的机器。

![img](https://cdn.nlark.com/yuque/0/2022/png/26752078/1659513114616-1bb73ae8-b09d-4bcb-a2dc-cac38be456a4.png)

这三台机器共同构成一个聊天系统，少了谁都缺少完整的功能。

对于用户管理功能，我们可以再提高并发量，对这个分布式节点进行集群部署。那么后台管理模块，就少点服务器就行了。而对于好友管理和群组管理，可能都用不完服务器的资源。我们可以往里面添加别的模块来利用机器剩余资源。

现在来看，我们可以使用分布式系统解决不能只编译部分模块的问题，同时也可以按需求对不同模块配置不服务器。

**分布式系统问题**

1. 大型系统的软件模块划分困难，各模块可能会实现大量重复的代码（需要你的模块之间低耦合性）
2. 各模块之间如何访问？比如用户管理模块怎么联系好友模块，之前是在一个进程里，直接调用函数就行。现在是部署在不同的服务器上，服务器A模块怎么调用服务器B模块上的一个业务方法呢？可以想到，这是会涉及到网络传输的。

![img](https://cdn.nlark.com/yuque/0/2022/png/26752078/1659513890945-ba904136-cb36-47dd-b7ef-21c85f6d57ea.png)

## 分布式网络通信框架

为了解决这个不同机器内调用方法的问题，我们需要设计一个分布式网络通信框架。

## 集群和分布式特点

**集群：** 每一台服务器独立运行一个工程的所有模块。 

**分布式：** 一个工程拆分了很多模块，每一个模块独立部署运行在一个服务器主机上，所有服务器协同工 作共同提供服务，每一台服务器称作分布式的一个节点，根据节点的并发要求，对一个节点可以再做节点模块集群部署。

## 参考

[什么是CPU密集型、IO密集型](https://blog.csdn.net/youanyyou/article/details/78990156)