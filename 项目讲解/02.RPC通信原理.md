现在我们面临一个问题，我们需要跨服务器调用方法得到结果。最开始，所以方法都在本机实现。我们直接调用一个函数即可，但现在我们需要调用的方法不属于同一进程。

既然是别的机器，那么很容易想到这个过程需要涉及网络通信。我们需要网络传输相关的信息到对端机器，表明自己需要调用哪个方法，传入的参数是什么。

而网络传输的是二进制数据，我们一般会在代码里使用结构体等信息来储存这些信息。因此我们需要将对象转换成二进制数据。这里涉及到了数据的编码转化，而这里我们使用 protobuf 来处理。 

对面接受到数据之后，就会解析数据来直到我们想要调用什么方法，传递过来了什么参数。而网络传输会涉及到分片，对端接受到的数据并不是连贯的。因此，我们需要涉及协议，对端根据协议就知道需要哪些数据是我们这一次请求的。这样不会和下一次请求混淆，也不会少读取了字节导致请求不清晰。

简而言之，一次 RPC 调用会涉及如下模块（这里以请求为例）：

1. 数据的序列化
2. 数据按照协议打包
3. 网络模块发送数据给对面

![img](https://cdn.nlark.com/yuque/0/2022/png/26752078/1659517421094-9e123753-f705-4480-8fa6-a1e9f4a965cf.png)

- 黄色部分：设计rpc方法参数的打包和解析，也就是数据的序列化和反序列化，使用Protobuf。 
- 绿色部分：网络部分，包括寻找rpc服务主机，发起rpc调用请求和响应rpc调用结果，使用muduo网络库和zookeeper服务配置中心（专门做服务发现）。  

**调用 rpc 方法流程，比如调用 Login 方法。**

```cpp
bool Login(string name, string pwd); // 调用rpc方法
```

调用此方法，但这是调用远端服务器的方法。所以需要把方法名字，参数进行序列化，打包形成字节流通过网络模块发送过去。对端接收字节流，反序列化得到需要被调用的方法并进行调用，之后将结果返回给对端。

所以，我们主要负责实现分布式网络通信框架，这样别人就可以使用我们的框架然后非常方便的向其他服务器发起方法调用。解决了不同进程间进行方法调用的难题。

我们的实现范围是客户端和服务端的黄色和绿色部分。

## protobuf 和 json 区别

数据的传输形式是 protobuf 而非 json，这是因为 protobuf 传递数据更见简洁，轻便。

1. protobuf 是二进制存储，xml 和 json是文本存储，protobuf 占空间更小
2. protobuf 不需要存储额外的信息，json 会存储字段之类的，比如 「name: "zhang san"」

而且 Protobuf 不仅仅是一种消息格式，它还是一组用于定义和交换这些消息的规则和工具。 谷歌是这个协议的创造者，已开源，并为常用的编程语言提供生成代码的工具，如JavaScript，Java，PHP，C＃，Ruby，Objective C，Python，C ++和Go。 除此之外，Protobuf具有比JSON更多的数据类型，如枚举和方法，并且还大量用于RPC（远程过程调用）。

本次项目就需要使用 protobuf 为我们提供的 RPC 接口。